Script started on Fri Dec 20 12:22:29 2019
[1m[7m%[27m[1m[0m                                                                                                                                                                                                                  u306065@imac-569[1] cat ctog.c
// ç”»åƒå‡¦ç† ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ã®å‘¼ã³å‡ºã—
// 2019/12/13 13:38
// u306065 æ«›ç”° ä¸€æ¨¹

#include<stdio.h>
#include<stdlib.h>

const double ycbcr[3][3] = {{ 0.2990, 0.5870, 0.1140},
                        { -0.1687, -0.3313, 0.5000},
                        { 0.5000, -0.4187, -0.0813}};
const double rgb[3][3] = {{ 1.0000, 0.0000, 1.4020},
                        { 1.0000, -0.3441, -0.7141},
                        { 1.0000, 1.7720, 0.0000}};

double ycbcr_cnv[3][512][512] = {}, do_ycbcr_cnv[3] = {}, rgbio[3] = {}, rgb_cnv[3][512][512] = {};
int int_ycbcr_cnv[3] = {}, int_rgbio[3] = {}, width, height, ins;

unsigned char header[54];
unsigned char imgin[3][512][512], imgout[3][512][512];

void rgb_to_ybr();
void ybr_to_rgb();
void get_data(int argc, char fname[]);
void put_data(int argc, char n_fname[]);
void processing();

// ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã®å¼•æ•°
int main(int argc, char *argv[]){
    get_data(argc, argv[1]);
    rgb_to_ybr();
    processing();
    ybr_to_rgb();
    put_data(argc, argv[2]);
    return 0;
}

void get_data(int argc, char fname[]){
    // char fname[20];
    FILE *fp;
    int i;

    // ãƒ•ã‚¡ã‚¤ãƒ«åã®å…¥åŠ›
    printf("å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«åï¼š %s\n", fname);
    // scanf("%s",fname);

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚ªãƒ¼ãƒ—ãƒ³
    fp = fopen(fname, "rb");

    if(fp == NULL){
        printf("ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚ªãƒ¼ãƒ—ãƒ³ã§ãã¾ã›ã‚“ã§ã—ãŸ\n");
        exit(1);
    }

    printf("ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚ªãƒ¼ãƒ—ãƒ³ã—ã¾ã—ãŸ.\n");

    // ãƒ˜ãƒƒãƒ€ãƒ¼æƒ…å ±ã®å–å¾—
    for(int cnt = 0; cnt < 54; cnt++){
        header[cnt] = fgetc(fp);
    }


    // printf("\n<ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—>\n");
    // for(i = 0; i < 2; i++){
    //     printf("header[%d] = %02x ", i, header[i]);
    // }
    // putchar('\n');

    printf("\n<ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º>\n");
    for(i = 2; i < 6; i++){
        printf("header[%d] = %02x ", i, header[i]);
    }
    int filesize = *(int *)&header[2];
    printf("\n%dãƒã‚¤ãƒˆ\n", filesize);
    
    // printf("\n<äºˆç´„é ˜åŸŸ>\n");
    // for(i = 6; i < 10; i++){
    //     printf("header[%d] = %02x ", i, header[i]);
    // }
    // putchar('\n');

    printf("\n<ã‚ªãƒ•ã‚»ãƒƒãƒˆ>\n");
    for(i = 10; i < 13; i++){
        printf("header[%d] = %02x ", i, header[i]);
    }
    int offset = *(int *)&header[10];
    printf("\n%dãƒã‚¤ãƒˆ\n", offset);

    // printf("\n<æƒ…å ±ãƒ˜ãƒƒãƒ€ã‚µã‚¤ã‚º>\n");
    // for(i = 14; i < 18; i++){
    //     printf("header[%d] = %02x ", i, header[i]);
    // }
    // putchar('\n');

    printf("\n<ç”»åƒã®å¹…>\n");
    for(i = 18; i < 22; i++){
        printf("header[%d] = %02x ", i, header[i]);
    }
    width = *(int *)&header[18];
    printf("\n%dç”»ç´ \n", width);

    printf("\n<ç”»åƒã®é«˜ã•>\n");
    for(i = 22; i < 26; i++){
        printf("header[%d] = %02x ", i, header[i]);
    }
    height = *(int *)&header[22];
    printf("\n%dãƒ©ã‚¤ãƒ³\n", height);

    // printf("\n<è‰²ãƒ—ãƒ¬ãƒ¼ãƒ³æ•°>\n");
    // for(i = 26; i < 28; i++){
    //     printf("header[%d] = %02x ", i, header[i]);
    // }
    // putchar('\n');
    
    printf("\n<1ç”»ç´ ã‚ãŸã‚Šã®ãƒ“ãƒƒãƒˆæ•°>\n");
    for(i = 28; i < 30; i++){
        printf("header[%d] = %02x ", i, header[i]);
    }
    int bit = *(int *)&header[28];
    printf("\n%oãƒ“ãƒƒãƒˆ\n", *(short *)&header[28]);
    
    // printf("\n<åœ§ç¸®æ–¹å¼>\n");
    // for(i = 30; i < 34; i++){
    //     printf("header[%d] = %02x ", i, header[i]);
    // }
    // putchar('\n');
    
    // printf("\n<ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º>\n");
    // for(i = 34; i < 38; i++){
    //     printf("header[%d] = %02x ", i, header[i]);
    // }
    // putchar('\n');
    
    // printf("\n<æ°´å¹³è§£åƒåº¦>\n");
    // for(i = 38; i < 42; i++){
    //     printf("header[%d] = %02x ", i, header[i]);
    // }
    // putchar('\n');
    
    // printf("\n<å‚ç›´è§£åƒåº¦>\n");
    // for(i = 42; i < 46; i++){
    //     printf("header[%d] = %02x ", i, header[i]);
    // }
    // putchar('\n');
    
    // printf("\n<è‰²æ•°>\n");
    // for(i = 46; i < 50; i++){
    //     printf("header[%d] = %02x ", i, header[i]);
    // }
    // putchar('\n');
    
    // printf("\n<é‡è¦ãªè‰²æ•°>\n");
    // for(i = 50; i < 54; i++){
    //     printf("header[%d] = %02x ", i, header[i]);
    // }
    // putchar('\n');
    
    printf("\n<æŒ¿å…¥ãƒ“ãƒƒãƒˆæ•°>\n");
    ins = filesize - offset - width * height * (bit / 8);
    printf("%dãƒã‚¤ãƒˆ\n\n", ins);


    for(i = height - 1; i >= 0; i--){
        for(int j = 0; j < width; j++){
            for(int k = 2; k >= 0; k--){
                imgin[k][i][j] = fgetc(fp);
            }
        }
    }

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¯ãƒ­ãƒ¼ã‚º
    fclose(fp); 
}

void rgb_to_ybr(){
    // å…¥åŠ›å€¤å‡ºåŠ›
    // printf("<å…¥åŠ›ä¿¡å·(RGB)>\n");
    // printf("---R---\n");
    // for(int i = 0; i < height; i++){
    //     for(int j = 0; j < width; j++){
    //         printf("%.2X ",imgin[0][i][j]);
    //     }
    //     putchar('\n');
    // }
    // printf("---G---\n");
    // for(int i = 0; i < height; i++){
    //     for(int j = 0; j < width; j++){
    //         printf("%.2X ",imgin[1][i][j]);
    //     }
    //     putchar('\n');
    // }
    // printf("---B---\n");
    // for(int i = 0; i < height; i++){
    //     for(int j = 0; j < width; j++){
    //         printf("%.2X ",imgin[2][i][j]);
    //     }
    //     putchar('\n');
    // }
    
    // YCbCrã¸ã®å¤‰æ›(æ•´æ•°)
    for(int i = 0; i < height; i++){
        for(int j = 0; j < width; j++){
            for(int k = 0; k < 3; k++){
                ycbcr_cnv[0][i][j] += ycbcr[0][k] * imgin[k][i][j];
                ycbcr_cnv[1][i][j] += ycbcr[1][k] * imgin[k][i][j];
                ycbcr_cnv[2][i][j] += ycbcr[2][k] * imgin[k][i][j];
            }
        }
    }

    // å››æ¨äº”å…¥
    for(int k = 0; k < 3; k++){
        for(int i = 0; i < height; i++){
            for(int j = 0; j < width; j++){
                if(ycbcr_cnv[k][i][j] >= 0){
                    ycbcr_cnv[k][i][j] += 0.5;
                    ycbcr_cnv[k][i][j] = (int)ycbcr_cnv[k][i][j];
                }else if(ycbcr_cnv[k][i][j] < 0){
                    ycbcr_cnv[k][i][j] -= 0.5;
                    ycbcr_cnv[k][i][j] = (int)ycbcr_cnv[k][i][j];
                }
            }
        }
    }

    // Cbã¨Crã«ã‚ªãƒ•ã‚»ãƒƒãƒˆåŠ ç®—
    for(int k = 1; k < 3; k++){
        for(int i = 0; i < height; i++){
            for(int j = 0 ; j < width; j++){
                ycbcr_cnv[k][i][j] += 128;
            }
        }
    }

    // 1ãƒã‚¤ãƒˆå¤–æ•°å€¤æ™‚ä¿®æ­£å‡¦ç†
    for(int i = 0; i < 3; i++){
        for(int j = 0; j < height; j++){
            for(int k = 0; k < width; k++){
                if(ycbcr_cnv[i][j][k] >= 255){
                    ycbcr_cnv[i][j][k] = 255;
                }else if(ycbcr_cnv[i][j][k] <= 0){
                    ycbcr_cnv[i][j][k] = 0;
                }
            }
        }
    }

    // imginã¸ã®ä¸Šæ›¸ãå‡¦ç†
    for(int i = 0; i < 3; i++){
        for(int j = 0; j < height; j++){
            for(int k = 0; k < width; k++){
                imgin[i][j][k] = (int)ycbcr_cnv[i][j][k];
            }
        }
    }
    
    // å‡ºåŠ›
    // printf("<å…¥åŠ›ä¿¡å·(YCbCr)>\n");
    // for(int i = 0; i < 3; i++){
    //     switch(i){
    //         case 0:{
    //             printf("--- Y ---\n");
    //             break;
    //         }
    //         case 1:{
    //             printf("--- Cb ---\n");
    //             break;
    //         }
    //         case 2:{
    //             printf("--- Cr ---\n");
    //             break;
    //         }
    //     }
    //     for(int j = 0; j < height; j++){
    //         for(int k = 0; k < width; k++){
    //             printf("%.2X ",imgin[i][j][k]);
    //         }
    //         putchar('\n');
    //     }
    // }
    putchar('\n');
}

void processing(){
    // int i, j, k, cpmode[3];
    // imgin 2 imgout
    // int half_width = width / 2, half_height = height / 2;
    
    // ãƒ¢ãƒã‚¯ãƒ­ã«ã™ã‚‹
    for (int j = 0; j < height; j++){
        for(int k = 0; k < width; k ++){
            imgout[1][j][k] = 128;
            imgout[2][j][k] = 128;
        }
    }


    // ã‚³ãƒ”ãƒ¼ã‚’è¡Œã†
    for(int j = 0; j < height; j++){
        for(int k = 0; k < width; k++){
    //        if( (j <= half_height && k > half_width)){
    //            // å³ä¸ŠåŒºç”»(å·¦ä¸ŠåŒºç”»ã®ã‚³ãƒ”ãƒ¼)
    //            imgout[0][j][k] = imgin[0][j][k - half_width];
    //        }else if(j > half_height && k <= half_width){
    //            // å·¦ä¸‹åŒºç”»(å·¦ä¸ŠåŒºç”»ã®ä¸Šä¸‹åè»¢ã‚³ãƒ”ãƒ¼)
    //            imgout[0][j][k] = imgin[0][half_height - (j - half_height)][k];
    //        }else if(j > half_height && k > half_width){
    //            // å³ä¸‹åŒºç”»(å·¦ä¸ŠåŒºç”»ã®ä¸Šä¸‹å·¦å³åè»¢ã‚³ãƒ”ãƒ¼)
    //            imgout[0][j][k] = imgin[0][half_height - (j - half_height)][half_width - (k - half_width)];
    //        }else{
                imgout[0][j][k] = imgin[0][j][k];
    //        }
        }
    }
 
    printf("\nå…¥åŠ›ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦å‡ºåŠ›ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ãŸ.\n");
}

void ybr_to_rgb(){
    // RGBå¤‰æ›(æ•´æ•°)
    // printf("<å‡ºåŠ›ä¿¡å·(YCbCr)>\n");
    // printf("--- Y ---\n");
    // for(int i = 0; i < height; i++){
    //     for(int j = 0; j < width; j++){
    //         printf("%.2X ",imgin[0][i][j]);
    //     }
    //     putchar('\n');
    // }
    // printf("--- Cb ---\n");
    // for(int i = 0; i < height; i++){
    //     for(int j = 0; j < width; j++){
    //         printf("%.2X ",imgin[1][i][j]);
    //     }
    //     putchar('\n');
    // }
    // printf("--- Cr ---\n");
    // for(int i = 0; i < height; i++){
    //     for(int j = 0; j < width; j++){
    //         printf("%.2X ",imgin[2][i][j]);
    //     }
    //     putchar('\n');
    // }
    // putchar('\n');


    // ã‚ªãƒ•ã‚»ãƒƒãƒˆåŠ ç®—å€¤æ¸›ç®—
    short tmp[3][512][512] = {};
    for(int i = 0; i < 3; i++){
        for(int j = 0; j < height; j++){
            for(int k = 0; k < width; k++){
                tmp[i][j][k] = imgout[i][j][k];
            }
        }
    }
    for(int i = 1; i < 3; i++){
        for(int j = 0; j < height; j++){
            for(int k = 0; k < width; k++){
                tmp[i][j][k] = tmp[i][j][k] - 128.0;
            }
        }
    }

    
    // RGBå¤‰æ›
    for(int i = 0; i < height; i++){
        for(int j = 0; j < width; j++){
            for(int k = 0; k < 3; k++){
                rgb_cnv[0][i][j] += rgb[0][k] * tmp[k][i][j];
                rgb_cnv[1][i][j] += rgb[1][k] * tmp[k][i][j];
                rgb_cnv[2][i][j] += rgb[2][k] * tmp[k][i][j];
            }
        }
    }

    // å››æ¨äº”å…¥
    for(int i = 0; i < 3; i++){
        for(int j = 0; j < height; j++){
            for(int k = 0; k < width; k++){
                if(rgb_cnv[i][j][k] >= 0){
                    rgb_cnv[i][j][k] += 0.5;
                }else if(rgb_cnv[i][j][k] < 0){
                    rgb_cnv[i][j][k] -= 0.5;
                }
                rgb_cnv[i][j][k] = (int)rgb_cnv[i][j][k];
            }
        }
    }

    // 1ãƒã‚¤ãƒˆç¯„å›²å¤–å€¤ä¿®æ­£å‡¦ç†
    for(int i = 0; i < 3; i++){
        for(int j = 0; j < height; j++){
            for(int k = 0; k < width; k++){
                if(rgb_cnv[i][j][k] > 255){
                    rgb_cnv[i][j][k] = 255;
                }else if(rgb_cnv[i][j][k] < 0){
                    rgb_cnv[i][j][k] = 0;
                }
            }
        }
    }

    // rgb_cnv 2 imgout
    for(int i = 0; i < 3; i++){
        for(int j = 0; j < height; j++){
            for(int k = 0; k < width; k++){
                imgout[i][j][k] = rgb_cnv[i][j][k];
            }
        }
    }

    // å‡ºåŠ›
    // printf("<å‡ºåŠ›ä¿¡å·(RGB)>\n");
    // for(int i = 0; i < 3; i++){
    //     switch(i){
    //         case 0:{
    //             printf("--- R ---\n");
    //             break;
    //         }
    //         case 1:{
    //             printf("--- G ---\n");
    //             break;
    //         }
    //         case 2:{
    //             printf("--- B ---\n");
    //             break;
    //         }
    //     }
    //     for(int j = 0; j < height; j++){
    //         for(int k = 0; k < width; k++){
    //             printf("%.2X ",imgout[i][j][k]);
    //         }
    //         putchar('\n');
    //     }
    // }
}

void put_data(int argc, char n_fname[]){
    // char n_fname[20];
    FILE *fp;
    printf("å‡ºåŠ›ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ãŸ.\n\n");
    printf("å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«å: %s\n", n_fname);
    // scanf("%s",n_fname);
    fp=fopen(n_fname,"wb");
    if(fp==NULL){
        printf("ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚ªãƒ¼ãƒ—ãƒ³ã§ãã¾ã›ã‚“\n");
        exit (1);
    }
    printf("ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚ªãƒ¼ãƒ—ãƒ³ã—ã¾ã—ãŸ\n");
    for(int i = 0; i < 54; i++){
        fputc(header[i],fp);
    }
    for(int i = height - 1; i >= 0; i--){
        for(int j = 0; j < width; j++){
            for(int k = 2; k >= 0; k--){
                fputc(imgout[k][i][j],fp );
            }
        }
    }
    fclose(fp);
    printf("ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¾ã—ãŸ\n");
}
                                                                                                                                                                                                                u306065@imac-569[2] gcc -Wall ctog.c -o ctog
u306065@imac-569[3] ctog parrots.bmp parrots_gray.bmp
å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«åï¼š parrots.bmp
ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚ªãƒ¼ãƒ—ãƒ³ã—ã¾ã—ãŸ.

<ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º>
header[2] = 38 header[3] = 00 header[4] = 03 header[5] = 00 
196664ãƒã‚¤ãƒˆ

<ã‚ªãƒ•ã‚»ãƒƒãƒˆ>
header[10] = 36 header[11] = 00 header[12] = 00 
54ãƒã‚¤ãƒˆ

<ç”»åƒã®å¹…>
header[18] = 00 header[19] = 01 header[20] = 00 header[21] = 00 
256ç”»ç´ 

<ç”»åƒã®é«˜ã•>
header[22] = 00 header[23] = 01 header[24] = 00 header[25] = 00 
256ãƒ©ã‚¤ãƒ³

<1ç”»ç´ ã‚ãŸã‚Šã®ãƒ“ãƒƒãƒˆæ•°>
header[28] = 18 header[29] = 00 
30ãƒ“ãƒƒãƒˆ

<æŒ¿å…¥ãƒ“ãƒƒãƒˆæ•°>
2ãƒã‚¤ãƒˆ



å…¥åŠ›ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦å‡ºåŠ›ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ãŸ.
å‡ºåŠ›ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ãŸ.

å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«å: parrots_gray.bmp
ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚ªãƒ¼ãƒ—ãƒ³ã—ã¾ã—ãŸ
ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¾ã—ãŸ

u306065@imac-569[4] exit

Script done on Fri Dec 20 12:23:55 2019
